import React, { useState } from 'react';
import { Heart, X, Trophy, Plus, Calendar, Trash2, Edit2, ChevronRight } from 'lucide-react';

const App = () => {
  const [activeTab, setActiveTab] = useState('likes');
  const [rankingSubTab, setRankingSubTab] = useState('likes');
  const [records, setRecords] = useState([]);
  const [showModal, setShowModal] = useState(false);
  const [editingId, setEditingId] = useState(null);

  const [formData, setFormData] = useState({
    content: '',
    rating: 0,
    type: 'likes'
  });

  const openModal = (type, item = null) => {
    if (item) {
      setFormData({ content: item.content, rating: item.rating, type: item.type });
      setEditingId(item.id);
    } else {
      setFormData({ content: '', rating: 0, type: type });
      setEditingId(null);
    }
    setShowModal(true);
  };

  const saveRecord = (e) => {
    e.preventDefault();
    if (!formData.content.trim() || formData.rating === 0) return;

    if (editingId) {
      setRecords(records.map(r => r.id === editingId ? { ...r, ...formData } : r));
    } else {
      const newRecord = {
        id: Date.now(),
        ...formData,
        date: new Date().toLocaleDateString('ko-KR', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit'
        })
      };
      setRecords([newRecord, ...records]);
    }
    
    setShowModal(false);
    setEditingId(null);
  };

  const deleteRecord = (id) => {
    setRecords(records.filter(r => r.id !== id));
  };

  const getFilteredRanking = (type) => {
    return [...records]
      .filter(item => item.type === type)
      .sort((a, b) => b.rating - a.rating);
  };

  const RatingIcons = ({ rating, type, interactive = false, onRate = null }) => {
    const isLike = type === 'likes';
    const Icon = isLike ? Heart : X;
    
    return (
      <div className="flex gap-1">
        {[1, 2, 3, 4, 5].map((val) => {
          const isActive = val <= rating;
          
          let iconClass = "";
          if (isLike) {
            iconClass = isActive 
              ? "text-rose-500 fill-rose-500 transition-all duration-200" 
              : "text-rose-300 fill-transparent transition-all duration-200";
          } else {
            iconClass = isActive 
              ? "text-blue-500 stroke-[3px] transition-all duration-200" 
              : "text-blue-300 stroke-[1.5px] transition-all duration-200";
          }

          return (
            <Icon
              key={val}
              size={interactive ? 28 : 13}
              className={`${iconClass} ${interactive ? 'cursor-pointer hover:scale-110 active:scale-90' : ''}`}
              onClick={() => interactive && onRate && onRate(val)}
            />
          );
        })}
      </div>
    );
  };

  // 탭별 배경색 결정 (기존보다 선명하게 수정)
  const getPageBg = () => {
    if (activeTab === 'likes') return 'bg-rose-100/50';
    if (activeTab === 'dislikes') return 'bg-blue-100/50';
    return 'bg-slate-50';
  };

  return (
    <div className={`flex flex-col h-screen transition-colors duration-300 ${getPageBg()} text-slate-800 max-w-md mx-auto shadow-2xl overflow-hidden border-x border-slate-100`} 
         style={{ fontFamily: "'Pretendard', -apple-system, 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif" }}>
      
      <header className="bg-white sticky top-0 z-10 px-6 py-2.5 border-b border-slate-100 shadow-sm">
        <div className="flex justify-between items-center">
          <h1 className="text-base font-bold text-slate-900 tracking-tight">
            {activeTab === 'likes' && '좋아하는 것'}
            {activeTab === 'dislikes' && '싫어하는 것'}
            {activeTab === 'ranking' && '랭킹'}
          </h1>
          {activeTab !== 'ranking' && (
            <button 
              onClick={() => openModal(activeTab)}
              className={`w-8 h-8 rounded-lg flex items-center justify-center text-white transition-all ${
                activeTab === 'likes' ? 'bg-rose-500 hover:bg-rose-600' : 'bg-blue-500 hover:bg-blue-600'
              }`}
            >
              <Plus size={18} />
            </button>
          )}
        </div>
      </header>

      <main className="flex-1 overflow-y-auto px-6 pt-4 pb-28">
        {activeTab === 'ranking' ? (
          <div className="space-y-6">
            <div className="flex bg-slate-200/50 p-1 rounded-xl">
              <button 
                onClick={() => setRankingSubTab('likes')}
                className={`flex-1 py-1.5 text-[11px] font-bold rounded-lg transition-all ${rankingSubTab === 'likes' ? 'bg-white text-rose-500 shadow-sm' : 'text-slate-400'}`}
              >
                베스트
              </button>
              <button 
                onClick={() => setRankingSubTab('dislikes')}
                className={`flex-1 py-1.5 text-[11px] font-bold rounded-lg transition-all ${rankingSubTab === 'dislikes' ? 'bg-white text-blue-500 shadow-sm' : 'text-slate-400'}`}
              >
                워스트
              </button>
            </div>

            <div className="space-y-2">
              {getFilteredRanking(rankingSubTab).length === 0 ? (
                <div className="text-center py-20 text-slate-300 text-xs">데이터가 없습니다.</div>
              ) : (
                getFilteredRanking(rankingSubTab).map((item, index) => (
                  <div key={item.id} className="bg-white p-3.5 rounded-xl border border-slate-50 flex items-center gap-4 shadow-sm group">
                    <div className={`flex-shrink-0 w-7 h-7 rounded-md flex items-center justify-center font-bold text-xs ${
                      rankingSubTab === 'likes' ? 'bg-rose-50 text-rose-500' : 'bg-blue-50 text-blue-500'
                    }`}>
                      {index + 1}
                    </div>
                    <div className="flex-1 flex justify-between items-center">
                      <h3 className="font-bold text-slate-800 text-sm tracking-tight">{item.content}</h3>
                      <RatingIcons rating={item.rating} type={item.type} />
                    </div>
                  </div>
                ))
              )}
            </div>
          </div>
        ) : (
          <div className="space-y-2.5">
            {records.filter(r => r.type === activeTab).length === 0 ? (
              <div className="flex flex-col items-center justify-center py-40 text-slate-300/50">
                {activeTab === 'likes' ? <Heart size={40} /> : <X size={40} />}
                <p className="mt-4 text-[11px] font-medium tracking-tight">기록된 내용이 없습니다</p>
              </div>
            ) : (
              records.filter(r => r.type === activeTab).map((item) => (
                <div key={item.id} className="bg-white p-3.5 rounded-xl border border-slate-50 shadow-sm hover:border-slate-100 transition-colors">
                  <div className="flex justify-between items-center mb-1.5">
                    <h3 className="font-bold text-slate-900 tracking-tight text-sm leading-tight">{item.content}</h3>
                    <div className="flex gap-1">
                      <button 
                        onClick={() => openModal(activeTab, item)}
                        className="w-6 h-6 flex items-center justify-center rounded-md text-slate-300 hover:text-slate-600 transition-all"
                      >
                        <Edit2 size={12} />
                      </button>
                      <button 
                        onClick={() => deleteRecord(item.id)}
                        className="w-6 h-6 flex items-center justify-center rounded-md text-slate-300 hover:text-rose-500 transition-all"
                      >
                        <Trash2 size={12} />
                      </button>
                    </div>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-[9px] font-medium text-slate-400 flex items-center gap-1">
                      <Calendar size={9} /> {item.date}
                    </span>
                    <RatingIcons rating={item.rating} type={item.type} />
                  </div>
                </div>
              ))
            )}
          </div>
        )}
      </main>

      <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/95 backdrop-blur-md border-t border-slate-100 flex justify-around items-center py-2 px-6 z-20">
        <NavButton 
          active={activeTab === 'likes'} 
          onClick={() => setActiveTab('likes')} 
          icon={<Heart size={18} className={activeTab === 'likes' ? 'fill-current' : ''} />} 
          label="좋아요"
          color={activeTab === 'likes' ? 'text-rose-500' : 'text-slate-300'}
        />
        <NavButton 
          active={activeTab === 'dislikes'} 
          onClick={() => setActiveTab('dislikes')} 
          icon={<X size={18} strokeWidth={activeTab === 'dislikes' ? 3 : 2} />} 
          label="싫어요"
          color={activeTab === 'dislikes' ? 'text-blue-500' : 'text-slate-300'}
        />
        <NavButton 
          active={activeTab === 'ranking'} 
          onClick={() => setActiveTab('ranking')} 
          icon={<Trophy size={18} className={activeTab === 'ranking' ? 'fill-current' : ''} />} 
          label="랭킹"
          color={activeTab === 'ranking' ? 'text-slate-900' : 'text-slate-300'}
        />
      </nav>

      {showModal && (
        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-6 z-50">
          <div className="bg-white w-full max-w-sm rounded-xl p-5 shadow-2xl animate-in fade-in zoom-in-95 duration-200 border border-slate-100">
            <div className="flex justify-between items-center mb-5">
              <h2 className="text-sm font-bold text-slate-900 tracking-tight">
                {editingId ? '기록 수정' : (formData.type === 'likes' ? '좋아하는 것' : '싫어하는 것')}
              </h2>
              <button onClick={() => setShowModal(false)} className="text-slate-400 hover:text-slate-900 transition-colors">
                <X size={18} />
              </button>
            </div>
            
            <form onSubmit={saveRecord}>
              <div className="mb-5">
                <label className="block text-[10px] font-bold text-slate-400 mb-1.5 tracking-tight uppercase">
                  {formData.type === 'likes' ? '좋아하는 것은?' : '싫어하는 것은?'}
                </label>
                <input
                  autoFocus
                  type="text"
                  placeholder="내용을 입력해주세요"
                  className="w-full bg-slate-50 border border-slate-100 rounded-lg px-3.5 py-2.5 text-xs text-slate-900 font-medium outline-none focus:ring-1 focus:ring-slate-200 transition-all placeholder:text-slate-300"
                  value={formData.content}
                  onChange={(e) => setFormData({ ...formData, content: e.target.value })}
                />
              </div>

              <div className="mb-6 flex justify-center">
                <div className="inline-block px-4 py-2.5 bg-slate-50 rounded-xl border border-slate-100">
                  <RatingIcons 
                    rating={formData.rating} 
                    type={formData.type}
                    interactive 
                    onRate={(val) => setFormData({ ...formData, rating: val })} 
                  />
                </div>
              </div>

              <button 
                type="submit"
                disabled={!formData.content.trim() || formData.rating === 0}
                className={`w-full py-2.5 rounded-lg font-bold text-xs text-white shadow-md transition-all active:scale-95 disabled:opacity-30 disabled:shadow-none ${
                  formData.type === 'likes' ? 'bg-rose-500 hover:bg-rose-600' : 'bg-blue-500 hover:bg-blue-600'
                }`}
              >
                {editingId ? '수정 완료' : '저장하기'}
              </button>
            </form>
          </div>
        </div>
      )}
    </div>
  );
};

const NavButton = ({ active, onClick, icon, label, color }) => (
  <button 
    onClick={onClick}
    className={`flex flex-col items-center gap-0.5 transition-all ${color}`}
  >
    <div className={`transition-transform duration-200 ${active ? 'scale-110' : 'scale-100'}`}>
      {icon}
    </div>
    <span className="text-[9px] font-bold tracking-tight">
      {label}
    </span>
  </button>
);

export default App;