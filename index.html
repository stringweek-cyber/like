<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>취향 기록장</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 내장 SVG 아이콘 컴포넌트 (라이브러리 오류 방지) ---
        const IconBase = ({ children, size = 18, className = "", strokeWidth = 2, fill = "none" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Heart = (props) => (
            <IconBase {...props}>
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.505 4.046 3 5.5L12 21l7-7Z"/>
            </IconBase>
        );

        const X = (props) => (
            <IconBase {...props}>
                <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
            </IconBase>
        );

        const Trophy = (props) => (
            <IconBase {...props}>
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
            </IconBase>
        );

        const Plus = (props) => (
            <IconBase {...props}>
                <path d="M5 12h14"/><path d="M12 5v14"/>
            </IconBase>
        );

        const Calendar = (props) => (
            <IconBase {...props}>
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/>
            </IconBase>
        );

        const Trash2 = (props) => (
            <IconBase {...props}>
                <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/>
            </IconBase>
        );

        const Edit2 = (props) => (
            <IconBase {...props}>
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
            </IconBase>
        );

        const ChevronRight = (props) => (
            <IconBase {...props}>
                <path d="m9 18 6-6-6-6"/>
            </IconBase>
        );

        const App = () => {
            const [activeTab, setActiveTab] = useState('likes');
            const [rankingSubTab, setRankingSubTab] = useState('likes');
            // 로컬 스토리지에서 데이터 불러오기
            const [records, setRecords] = useState(() => {
                const saved = localStorage.getItem('preference-records');
                return saved ? JSON.parse(saved) : [];
            });
            const [showModal, setShowModal] = useState(false);
            const [editingId, setEditingId] = useState(null);

            const [formData, setFormData] = useState({
                content: '',
                rating: 0,
                type: 'likes'
            });

            // 데이터가 변경될 때마다 로컬 스토리지에 저장
            useEffect(() => {
                localStorage.setItem('preference-records', JSON.stringify(records));
            }, [records]);

            const openModal = (type, item = null) => {
                if (item) {
                    setFormData({ content: item.content, rating: item.rating, type: item.type });
                    setEditingId(item.id);
                } else {
                    setFormData({ content: '', rating: 0, type: type });
                    setEditingId(null);
                }
                setShowModal(true);
            };

            const saveRecord = (e) => {
                e.preventDefault();
                if (!formData.content.trim() || formData.rating === 0) return;

                if (editingId) {
                    setRecords(records.map(r => r.id === editingId ? { ...r, ...formData } : r));
                } else {
                    const newRecord = {
                        id: Date.now(),
                        ...formData,
                        date: new Date().toLocaleDateString('ko-KR', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit'
                        })
                    };
                    setRecords([newRecord, ...records]);
                }
                
                setShowModal(false);
                setEditingId(null);
            };

            const deleteRecord = (id) => {
                setRecords(records.filter(r => r.id !== id));
            };

            const getFilteredRanking = (type) => {
                return [...records]
                    .filter(item => item.type === type)
                    .sort((a, b) => b.rating - a.rating);
            };

            const RatingIcons = ({ rating, type, interactive = false, onRate = null }) => {
                const isLike = type === 'likes';
                const IconComponent = isLike ? Heart : X;
                
                return (
                    <div className="flex gap-1">
                        {[1, 2, 3, 4, 5].map((val) => {
                            const isActive = val <= rating;
                            let iconClass = "";
                            let fill = "none";
                            
                            if (isLike) {
                                if (isActive) {
                                    iconClass = "text-rose-500 transition-all duration-200";
                                    fill = "currentColor";
                                } else {
                                    iconClass = "text-rose-300 transition-all duration-200";
                                }
                            } else {
                                if (isActive) {
                                    iconClass = "text-blue-500 transition-all duration-200";
                                } else {
                                    iconClass = "text-blue-300 transition-all duration-200";
                                }
                            }

                            return (
                                <IconComponent
                                    key={val}
                                    size={interactive ? 28 : 13}
                                    strokeWidth={!isLike && isActive ? 3 : 1.5}
                                    fill={fill}
                                    className={`${iconClass} ${interactive ? 'cursor-pointer hover:scale-110 active:scale-90' : ''}`}
                                    onClick={() => interactive && onRate && onRate(val)}
                                />
                            );
                        })}
                    </div>
                );
            };

            const getPageBg = () => {
                if (activeTab === 'likes') return 'bg-rose-100/50';
                if (activeTab === 'dislikes') return 'bg-blue-100/50';
                return 'bg-slate-50';
            };

            const NavButton = ({ active, onClick, icon, label, color }) => (
                <button onClick={onClick} className={`flex flex-col items-center gap-0.5 transition-all ${color}`}>
                    <div className={`transition-transform duration-200 ${active ? 'scale-110' : 'scale-100'}`}>
                        {icon}
                    </div>
                    <span className="text-[9px] font-bold tracking-tight">{label}</span>
                </button>
            );

            return (
                <div className={`flex flex-col h-screen transition-colors duration-300 ${getPageBg()} text-slate-800 max-w-md mx-auto shadow-2xl overflow-hidden border-x border-slate-100`}>
                    <header className="bg-white sticky top-0 z-10 px-6 py-2.5 border-b border-slate-100 shadow-sm">
                        <div className="flex justify-between items-center">
                            <h1 className="text-base font-bold text-slate-900 tracking-tight">
                                {activeTab === 'likes' && '좋아하는 것'}
                                {activeTab === 'dislikes' && '싫어하는 것'}
                                {activeTab === 'ranking' && '랭킹'}
                            </h1>
                            {activeTab !== 'ranking' && (
                                <button onClick={() => openModal(activeTab)} className={`w-8 h-8 rounded-lg flex items-center justify-center text-white transition-all ${activeTab === 'likes' ? 'bg-rose-500 hover:bg-rose-600' : 'bg-blue-500 hover:bg-blue-600'}`}>
                                    <Plus size={18} />
                                </button>
                            )}
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto px-6 pt-4 pb-28 no-scrollbar">
                        {activeTab === 'ranking' ? (
                            <div className="space-y-6">
                                <div className="flex bg-slate-200/50 p-1 rounded-xl">
                                    <button onClick={() => setRankingSubTab('likes')} className={`flex-1 py-1.5 text-[11px] font-bold rounded-lg transition-all ${rankingSubTab === 'likes' ? 'bg-white text-rose-500 shadow-sm' : 'text-slate-400'}`}>베스트</button>
                                    <button onClick={() => setRankingSubTab('dislikes')} className={`flex-1 py-1.5 text-[11px] font-bold rounded-lg transition-all ${rankingSubTab === 'dislikes' ? 'bg-white text-blue-500 shadow-sm' : 'text-slate-400'}`}>워스트</button>
                                </div>
                                <div className="space-y-2">
                                    {getFilteredRanking(rankingSubTab).length === 0 ? (
                                        <div className="text-center py-20 text-slate-300 text-xs">데이터가 없습니다.</div>
                                    ) : (
                                        getFilteredRanking(rankingSubTab).map((item, index) => (
                                            <div key={item.id} className="bg-white p-3.5 rounded-xl border border-slate-50 flex items-center gap-4 shadow-sm group">
                                                <div className={`flex-shrink-0 w-7 h-7 rounded-md flex items-center justify-center font-bold text-xs ${rankingSubTab === 'likes' ? 'bg-rose-50 text-rose-500' : 'bg-blue-50 text-blue-500'}`}>{index + 1}</div>
                                                <div className="flex-1 flex justify-between items-center">
                                                    <h3 className="font-bold text-slate-800 text-sm tracking-tight">{item.content}</h3>
                                                    <RatingIcons rating={item.rating} type={item.type} />
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-2.5">
                                {records.filter(r => r.type === activeTab).length === 0 ? (
                                    <div className="flex flex-col items-center justify-center py-40 text-slate-300/50">
                                        {activeTab === 'likes' ? <Heart size={40} /> : <X size={40} />}
                                        <p className="mt-4 text-[11px] font-medium tracking-tight">기록된 내용이 없습니다</p>
                                    </div>
                                ) : (
                                    records.filter(r => r.type === activeTab).map((item) => (
                                        <div key={item.id} className="bg-white p-3.5 rounded-xl border border-slate-50 shadow-sm transition-colors">
                                            <div className="flex justify-between items-center mb-1.5">
                                                <h3 className="font-bold text-slate-900 text-sm leading-tight">{item.content}</h3>
                                                <div className="flex gap-1">
                                                    <button onClick={() => openModal(activeTab, item)} className="w-6 h-6 flex items-center justify-center rounded-md text-slate-300 hover:text-slate-600 transition-all"><Edit2 size={12} /></button>
                                                    <button onClick={() => deleteRecord(item.id)} className="w-6 h-6 flex items-center justify-center rounded-md text-slate-300 hover:text-rose-500 transition-all"><Trash2 size={12} /></button>
                                                </div>
                                            </div>
                                            <div className="flex justify-between items-center">
                                                <span className="text-[9px] font-medium text-slate-400 flex items-center gap-1"><Calendar size={9} /> {item.date}</span>
                                                <RatingIcons rating={item.rating} type={item.type} />
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/95 backdrop-blur-md border-t border-slate-100 flex justify-around items-center py-2 px-6 z-20">
                        <NavButton active={activeTab === 'likes'} onClick={() => setActiveTab('likes')} icon={<Heart size={18} fill={activeTab === 'likes' ? 'currentColor' : 'none'} />} label="좋아요" color={activeTab === 'likes' ? 'text-rose-500' : 'text-slate-300'} />
                        <NavButton active={activeTab === 'dislikes'} onClick={() => setActiveTab('dislikes')} icon={<X size={18} strokeWidth={activeTab === 'dislikes' ? 3 : 2} />} label="싫어요" color={activeTab === 'dislikes' ? 'text-blue-500' : 'text-slate-300'} />
                        <NavButton active={activeTab === 'ranking'} onClick={() => setActiveTab('ranking')} icon={<Trophy size={18} fill={activeTab === 'ranking' ? 'currentColor' : 'none'} />} label="랭킹" color={activeTab === 'ranking' ? 'text-slate-900' : 'text-slate-300'} />
                    </nav>

                    {showModal && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-6 z-50">
                            <div className="bg-white w-full max-w-sm rounded-xl p-5 shadow-2xl animate-in fade-in zoom-in-95 duration-200 border border-slate-100">
                                <div className="flex justify-between items-center mb-5">
                                    <h2 className="text-sm font-bold text-slate-900">{editingId ? '기록 수정' : (formData.type === 'likes' ? '좋아하는 것' : '싫어하는 것')}</h2>
                                    <button onClick={() => setShowModal(false)} className="text-slate-400 hover:text-slate-900"><X size={18} /></button>
                                </div>
                                <form onSubmit={saveRecord}>
                                    <div className="mb-5">
                                        <label className="block text-[10px] font-bold text-slate-400 mb-1.5 uppercase tracking-tight">{formData.type === 'likes' ? '좋아하는 것은?' : '싫어하는 것은?'}</label>
                                        <input autoFocus type="text" placeholder="내용을 입력해주세요" className="w-full bg-slate-50 border border-slate-100 rounded-lg px-3.5 py-2.5 text-xs text-slate-900 font-medium outline-none focus:ring-1 focus:ring-slate-200 transition-all" value={formData.content} onChange={(e) => setFormData({ ...formData, content: e.target.value })} />
                                    </div>
                                    <div className="mb-6 flex justify-center">
                                        <div className="inline-block px-4 py-2.5 bg-slate-50 rounded-xl border border-slate-100">
                                            <RatingIcons rating={formData.rating} type={formData.type} interactive onRate={(val) => setFormData({ ...formData, rating: val })} />
                                        </div>
                                    </div>
                                    <button type="submit" disabled={!formData.content.trim() || formData.rating === 0} className={`w-full py-2.5 rounded-lg font-bold text-xs text-white shadow-md transition-all active:scale-95 disabled:opacity-30 ${formData.type === 'likes' ? 'bg-rose-500 hover:bg-rose-600' : 'bg-blue-500 hover:bg-blue-600'}`}>
                                        {editingId ? '수정 완료' : '저장하기'}
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
